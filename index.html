<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Game Outsuide Game</title>
<style>
body{font-family:system-ui,Segoe UI,Inter,Arial,Helvetica,sans-serif;padding:20px;max-width:720px;margin:auto;background:#0b0f14;color:#e7eaf0;line-height:1.6}
h1{font-size:1.4rem;margin:0 0 12px}
.card{background:#121822;border:1px solid #1e2633;border-radius:12px;padding:16px;margin:14px 0}
.title{font-weight:700;margin-bottom:6px}
input{width:100%;padding:14px 16px;font-size:18px;border-radius:10px;border:1px solid #2a3445;background:#0f1520;color:#e7eaf0}
button{width:100%;padding:12px 16px;font-size:16px;border-radius:10px;border:0;background:#2f80ed;color:white;margin-top:10px}
.ok{color:#48e768;font-weight:700}
.bad{color:#ff6b6b;font-weight:700}
.hint{opacity:.9;margin-top:6px}
img.level-img{width:100%;border-radius:8px;margin-top:10px}
</style>
</head>
<body>
<h1>Game Outsuide Game</h1>
<p>‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ñ‡∏π‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚Äú‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</p>
<div id="app">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Å‡∏°‚Ä¶</div>

<script>
let gameData, cur = 0;
let bgmAudio = null;

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏ö‡∏ö‡∏ß‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ß‡πâ‡∏ô 2 ‡∏ß‡∏¥‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö
function playSound(src, loop = false, delayMs = 2000) {
  if (!src) return null;
  const audio = new Audio(src);
  if (loop) {
    audio.addEventListener('ended', () => {
      setTimeout(() => {
        audio.currentTime = 0;
        audio.play();
      }, delayMs);
    });
  }
  audio.play();
  return audio;
}

function stopSound(audio) {
  if (audio) {
    audio.pause();
    audio.currentTime = 0;
  }
}

// ‡πÇ‡∏´‡∏•‡∏î JSON
fetch('games.json')
  .then(res => res.json())
  .then(data => {
    gameData = data;
    render();
  })
  .catch(err => {
    document.getElementById('app').innerHTML = "<p>‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>";
    console.error(err);
  });

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏î‡πà‡∏≤‡∏ô
function render(){
  if(cur >= gameData.levels.length){
    document.getElementById('app').innerHTML = `
      <div class="card">
        <div class="title">üéâ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏î‡πà‡∏≤‡∏ô!</div>
        <p class="ok">‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤‡πÅ‡∏•‡πâ‡∏ß</p>
      </div>`;
    playSound(gameData.global_sounds.reward);
    return;
  }

  const L = gameData.levels[cur];

  // ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏î‡∏¥‡∏°
  stopSound(bgmAudio);

  // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
  if (L.files?.level_sound) {
    bgmAudio = playSound(L.files.level_sound, true, 2000); // loop + delay 2 ‡∏ß‡∏¥
  }

  let imgs = "";
  if(L.images){
    imgs = L.images.map(url=>`<img src="${url}" class="level-img">`).join("");
  }

  document.getElementById('app').innerHTML = `
    <div class="card">
      <div class="title">‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà ${cur+1}: ${L.name}</div>
      <p><strong>‡πÇ‡∏à‡∏ó‡∏¢‡πå:</strong> <code>${L.prompt}</code></p>
      <input id="ans" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‚Ä¶">
      <button onclick="check()">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
      <p class="hint">‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ: ${L.hint}</p>
      ${imgs}
      <div id="msg"></div>
    </div>
  `;
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
function check(){
  const v = document.getElementById('ans').value || "";
  const L = gameData.levels[cur];
  const msg = document.getElementById('msg');

  const pattern = new RegExp(L.pattern, "i");
  if(pattern.test(v)){
    msg.innerHTML = '<p class="ok">‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂</p>';
    playSound(gameData.global_sounds.correct);
    cur++;
    setTimeout(render, 600);
  }else{
    msg.innerHTML = '<p class="bad">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏π‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ</p>';
    playSound(gameData.global_sounds.wrong);
  }
}
</script>
</body>
</html>
